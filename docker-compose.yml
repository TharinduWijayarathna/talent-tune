# Docker Compose for Dokploy deployment
#
# In Dokploy:
# 1. Set Compose Path to ./docker-compose.yml
# 2. Domains tab → Add Domain (e.g. talenttune.site) → set CONTAINER PORT to 80
# 3. Environment tab: set APP_KEY, APP_URL, DB_* (or DATABASE_URL), etc.
# 4. Deploy (builds from Dockerfile). Traefik will route the domain to this container on port 80.

version: "3.8"

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    # Container listens on 80. Traefik (Dokploy) routes domain → this service:80.
    expose:
      - 80
    ports:
      - "80"
    env_file:
      - .env
    environment:
      - APP_ENV=production
      # - APP_URL=https://talenttune.site
    volumes:
      - app_storage:/app/storage
      - app_bootstrap_cache:/app/bootstrap/cache
      - app_database:/app/database
    networks:
      - dokploy-network
    # Traefik: app listens on port 80 (Dokploy Domains will add Host rule when you add a domain)
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.talenttune-app.loadbalancer.server.port=80"

volumes:
  app_storage:
  app_bootstrap_cache:
  app_database:

networks:
  dokploy-network:
    external: true
